<?
//================== DB 설정 파일을 불러옴 ===============================================
include "../../connect.php";
//================== 함수 파일을 불러옴 ==================================================
include "../../main.class";
?>
<?
// 상품조회수를 업데이트
$sql = "update $ItemTable set read_num=read_num+1 where mart_id='$mart_id' and item_no='$item_no'";
mysql_query($sql, $dbconn);

//================== 상품 정보를 불러옴 ==================================================
$item_sql = "select * from $ItemTable where mart_id='$mart_id' and item_no='$item_no'";
$item_res = mysql_query($item_sql, $dbconn);
$item_tot = mysql_num_rows($item_res);
if($item_tot > 0){
	$item_row = mysql_fetch_array($item_res);

	$category_num = $item_row[firstno];
	$category_num1 = $item_row[prevno];
	$prevno = $category_num1;
	$cate_num = $item_row[category_num];
	$category_num2 = $cate_num;
	$item_name = $item_row[item_name];
	$item_order  = $item_row[item_order];
	$price  = $item_row[price];
	$z_price  = $item_row[z_price];
	$member_price = $item_row[member_price];
	$bonus = $item_row[bonus];
	$use_bonus = $item_row[use_bonus];
	$jaego = $item_row[jaego];
	$opt = $item_row[opt];
	$item_company = $item_row[item_company];
	$item_code = $item_row[item_code];
	$use_opt1 = $item_row[use_opt1];
	$use_opt23 = $item_row[use_opt23];
	$jaego_use = $item_row[jaego_use];
	$icon_no = $item_row[icon_no];
	//$use_coupon = $item_row[use_coupon];
	$provider_id = $item_row[provider_id];
	$if_hide = $item_row[if_hide];
	$parcel_price=$item_row[parcel_price];
	$gibon=$item_row[gibon];
	
	$fee = $item_row[fee];
	if($fee=="무료배송"){
		$parcel_price=0;
	}
	$if_customer_price = $item_row[if_strike];
	/*
	if( $if_hide != 0 ){
		echo "
			<script>
			alert('현재 판매되지 않는 상품입니다');
			location.href='../../.';
			</script>
		";
		exit;
	}*/

	//============================== 상점명을 가져옴 =====================================
	$me_sql = "select * from $MemberTable where mart_id='$mart_id' and username='$provider_id'";
	$me_res = mysql_query($me_sql, $dbconn);
	$me_row = mysql_fetch_array($me_res);
	$in_name = $me_row[name];
	$me_delivery = $me_row[me_delivery];
	$me_delivery_price = number_format($parcel_price);

	if( $fee == "착불" ){
		$me_delivery_str = "$fee";
	}else{
		$me_delivery_str = "$fee";
	}

	if( !$in_name ){
		$in_name = "공급사 없음";
	}

	$img_sml = $item_row[img_sml];
	$img = $item_row[img];
	$img_big = $item_row[img_big];
	$img_high = $item_row[img_high];
	$item_explain = $item_row[item_explain];
	$item_order  = $item_row[item_order];
	$flash_big_height  = $item_row[flash_big_height];
	$flash_big_width  = $item_row[flash_big_width];
	
	$opts = explode("=", $opt);
	
	if(!empty($opt1)){
		$opt1_1 = explode("^", $opt1);
		if(!empty($opt1_1[1])){
			$z_price = $opt1_1[1];
		}
		if(!empty($opt1_1[2])){
			$bonus = $opt1_1[2];
		}
		if(!empty($opt1_1[3])){
			$member_price = $opt1_1[3];
		}
	}



	if(!empty($opt2)){
		$opt2_1 = explode("^", $opt2);
		if(!empty($opt2_1[1])){
			$z_price = $z_price + $opt2_1[1];
		}
	}
	
	if(!empty($opt3)){
		$opt3_1 = explode("^", $opt3);
		if(!empty($opt3_1[1])){
			$z_price = $z_price + $opt3_1[1];
		}
	}


	$seller_price = 0;
	$seller_mem_price = 0;
	$seller_bonus = 0;
	$seller_icon_no = '';

	if($seller_price > 0)	$z_price = $seller_price;
	if($seller_mem_price > 0) $member_price = $seller_mem_price;
	if($seller_bonus > 0)	$bonus = $seller_bonus;
	if($seller_icon_no != '')	$icon_no = $seller_icon_no;
	
	if($if_member_price == '1' && $if_login == 1){
		if($member_price == 0)
			$z_price = round($z_price * $member_price_percent / 100, -2);
		else
			$z_price = $member_price;	
	}
	$price_str = number_format($price);
	$z_price_str = number_format($z_price);
	$bonus_str = number_format($bonus);

	$quan_sql = "select quantity from $Order_ProTable where order_num='$order_num' and mart_id='$mart_id' and item_no='$item_no' and status = '0'";
	$quan_res = mysql_query($quan_sql, $dbconn);
	$quan_tot = mysql_num_rows($quan_res);
	if($quan_tot > 0){
		$quan_row = mysql_fetch_array($quan_res);
		$quantity_incart = $quan_row[quantity];
		$jaego = $jaego - $quantity_incart;
	}
	
	if(($jaego_use == 1 && $jaego == 0) || ($if_hide==1)){
		$icon_str = "<img src='../image/soldout_icon_s.gif' width='25' height='12'>";
	}else{
		if($icon_no == 0) $icon_str = "";
		if($icon_no == 1) $icon_str = "<img src='../image/hot.gif' width='22' height='13'>";
		if($icon_no == 2) $icon_str = "<img src='../image/new.gif' width='25' height='14'>";
		if($icon_no == 3) $icon_str = "<img src='../image/sale.gif' width='22' height='13'>";
		if($icon_no == 4) $icon_str = "<img src='../image/reserv.gif' width='53' height='12'>";
	}	
	
	/*if($img_big!=""&&file_exists("$Co_img_UP$mart_id/$img_big")){
		if(strstr(strtolower(substr($img_big,-4)),'.swf')&&$flash_big_width!=''&&$flash_big_height!=''){
			$width = $flash_big_width;
			$height = $flash_big_height;
			$height1 = $flash_big_height+30;
		}else{	
			$size = @GetImageSize ("$Co_img_UP$mart_id/$img_big");
			$width = $size[0];
			$height = $size[1];
			$height1 = $size[1]+30;
		}
	}else if($img!=""&&file_exists("$Co_img_UP$mart_id/$img")){
		$size = @GetImageSize ("$Co_img_UP$mart_id/$img");
		$width = $size[0];
		$height = $size[1];
		$height1 = $size[1]+30;
	}else if($img_sml!=""&&file_exists("$Co_img_UP$mart_id/$img_sml")){
		$size = @GetImageSize ("$Co_img_UP$mart_id/$img_sml");
		$width = $size[0];
		$height = $size[1];
		$height1 = $size[1]+30;
	}*/
		
	if($img != "" && file_exists("$Co_img_UP$mart_id/$img")){
		if (strstr(strtolower(substr($img,-4)),'.jpg') || strstr(strtolower(substr($img,-4)),'.gif')){
			$img_str = "<img src='../..$Co_img_DOWN$mart_id/$img' width='$view_product_img_width' height='$view_product_img_height' border='0'>";
		}
		if (strstr(strtolower(substr($img,-4)),'.swf')){
			$img_str = "<embed src='../..$Co_img_DOWN$mart_id/$img' width='$view_product_img_width' height='$view_product_img_height'></embed>";
		}	
	}else if($img_big != "" && file_exists("$Co_img_UP$mart_id/$img_big")){
		if (strstr(strtolower(substr($img_big,-4)),'.jpg') || strstr(strtolower(substr($img_big,-4)),'.gif')){
			$img_str = "<img src='../..$Co_img_DOWN$mart_id/$img_big' width='$view_product_img_width' height='$view_product_img_height' border='0'>";
		}
		if (strstr(strtolower(substr($img_big,-4)),'.swf')){
			$img_str = "<embed src='../..$Co_img_DOWN$mart_id/$img_big' width='$view_product_img_width' height='$view_product_img_height'></embed>";
		}	
	}else if($img_sml != "" && file_exists("$Co_img_UP$mart_id/$img_sml")){
		if (strstr(strtolower(substr($img_sml,-4)),'.jpg') || strstr(strtolower(substr($img_sml,-4)),'.gif')){
			$img_str = "<img src='../..$Co_img_DOWN$mart_id/$img_sml' border='0' width='$view_product_img_width' height='$view_product_img_height' border='0'>";
		}
		if (strstr(strtolower(substr($img_sml,-4)),'.swf')){
			$img_str = "<embed src='../..$Co_img_DOWN$mart_id/$img_sml' width='$view_product_img_width' height='$view_product_img_height'></embed>";
		}	
	}else{
		$img_str = "<img src='../image/noimage_m.gif' border='0' width='$view_product_img_width' height='$view_product_img_height' border='0'>";
	}			
	
	if( $img_big ){
		$target4 = "../..$Co_img_DOWN$mart_id/$img_big";
		//==================== 이미지 사이즈를 구함 ======================================
		$img_size1 = @GetImageSize("$target4"); 
		$img_width1 = $img_size1[0] + 100; //이미지의 넓이를 알 수 있음 
		$img_height1 = $img_size1[1]; //이미지의 높이를 알 수 있음
		$img_height1 = $img_height1 + 120;
		$img_link_str = "<a onClick=\"window.open('../main/big.html?item_no=$item_no&file=$target4','원본사진보기','width=$img_width1,height=$img_height1,top=0,left=0,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=no')\" style='cursor:hand'>";
	}else if( $img ){
		$target4 = "../..$Co_img_DOWN$mart_id/$img";
		//==================== 이미지 사이즈를 구함 ======================================
		$img_size1 = @GetImageSize("$target4"); 
		$img_width1 = $img_size1[0] + 100; //이미지의 넓이를 알 수 있음 
		$img_height1 = $img_size1[1]; //이미지의 높이를 알 수 있음
		$img_height1 = $img_height1 + 120;
		$img_link_str = "<a onClick=\"window.open('../main/big.html?item_no=$item_no&file=$target4','원본사진보기','width=$img_width1,height=$img_height1,top=0,left=0,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=no')\" style='cursor:hand'>";
	}else if( $img_sml ){
		$target4 = "../..$Co_img_DOWN$mart_id/$img_sml";
		//==================== 이미지 사이즈를 구함 ======================================
		$img_size1 = @GetImageSize("$target4"); 
		$img_width1 = $img_size1[0] + 100; //이미지의 넓이를 알 수 있음 
		$img_height1 = $img_size1[1]; //이미지의 높이를 알 수 있음
		$img_height1 = $img_height1 + 120;
		$img_link_str = "<a onClick=\"window.open('../main/big.html?item_no=$item_no&file=$target4','원본사진보기','width=$img_width1,height=$img_height1,top=0,left=0,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=no')\" style='cursor:hand'>";
	}else{
		$img_link_str = "";
	}
}

//================== 1차 카테고리 정보를 불러옴 ==========================================
$sql = "select * from $CategoryTable where category_num='$category_num' and if_hide='0' and mart_id='$mart_id'";
$res = mysql_query($sql, $dbconn);
$row = mysql_fetch_array( $res );
$category_prevno = $row[prevno];
$category_name = $row[category_name];
//================== 2차 카테고리 정보를 불러옴 ==========================================
$sql1 = "select * from $CategoryTable where category_num='$category_num1' and if_hide='0' and mart_id='$mart_id'";
$res1 = mysql_query($sql1, $dbconn);
$row1 = mysql_fetch_array( $res1 );
$category_prevno1 = $row1[prevno];
$category_name1 = $row1[category_name];
//================== 3차 카테고리 정보를 불러옴 ==========================================
$sql2 = "select * from $CategoryTable where category_num='$category_num2' and if_hide='0' and mart_id='$mart_id'";
$res2 = mysql_query($sql2, $dbconn);
$row2 = mysql_fetch_array( $res2 );
$category_prevno2 = $row2[prevno];
$category_name2 = $row2[category_name];

//================== 상품평 정보를 불러옴 ================================================
if($provider_id == ""){
	$mart_id_tmp1 = $mart_id;
}else{
	$mart_id_tmp1 = $provider_id;
}

if($page == ""){
	$page = 1;
}

$est_qry = "select count(*) from $EstimateTable where item_no='$item_no' and mart_id='$mart_id' and estimate_ok='y'";

$est_result = mysql_query( $est_qry, $dbconn );
$est_tot = mysql_result( $est_result, 0, 0);

$line = 10;
$list = 10;
$total_page = ceil($est_tot/$line);
$total_list = intval($total_page/$list);

if($total_page%$list == 0){
	$total_list--;
}

$curr_list = intval($page/$list);

if($page%$list == 0){
	$curr_list--;
}

$start_page = $curr_list*$list+1;
$prev_list = $start_page - $list;
$next_list = $start_page + $list;
$olds = $line*($page-1);

$est_sql = "select * from $EstimateTable where item_no='$item_no' and mart_id='$mart_id' and estimate_ok='y' order by est_no desc limit $olds,$line";
$est_res = mysql_query($est_sql, $dbconn);

//================== 2차 카테고리 정보가 없을때 ==========================================
if( !$category_num1 ){
	$nocate_sql2 = "select * from $CategoryTable where category_num='$prevno' and if_hide='0' and mart_id='$mart_id'";
	$nocate_res2 = mysql_query($nocate_sql2, $dbconn);
	$nocate_row2 = mysql_fetch_array( $nocate_res2 );
	$category_prevno1 = $nocate_row2[prevno];
	$category_num1 = $nocate_row2[category_num];
	$category_name1 = $nocate_row2[category_name];
}

//================== 3차 카테고리 정보가 없을때 ==========================================
if( !$category_num2 ){
	$nocate_sql3 = "select * from $CategoryTable where prevno='$prevno' and category_num='$cate_num' and if_hide='0' and mart_id='$mart_id'";
	$nocate_res3 = mysql_query($nocate_sql3, $dbconn);
	$nocate_row3 = mysql_fetch_array( $nocate_res3 );
	$category_prevno2 = $nocate_row3[prevno];
	$category_num2 = $nocate_row3[category_num];
	$category_name2 = $nocate_row3[category_name];
}

//================== 로그인 했을때 상품평 글쓰기 링크함 ==================================
if( $UnameSess ){
	$write_memo = "<a onclick=\"CenterWin('./est_write.html?mart_id=$mart_id&item_no=$item_no','est_write', 'toolbar=no,menubar=no,status=no,scrollbars=yes,resizable=no,width=550,height=650');\"><img src='../image/bu_estimate_write.gif' width='70' height='20' border='0' align='absmiddle' style='cursor:hand'></a>";
}else{
	$write_memo = "<a onclick=\"login_confirm();\"><img src='../image/bu_estimate_write.gif' width='70' height='20' border='0' align='absmiddle' style='cursor:hand'></a>";
}

?>
<?
//================== 오늘 본 상품을 쿠키에 넣음 ==========================================
include "../main/today_hit.php";
?>
<?
include "../include/getmartinfo.php";
include "../include/head_alltemplate.php";
?>

<script language="javascript">
<!--
function page_reload() { 
	document.form.submit();
}
function addorder(){
	var form = document.form;
	var Digit = '1234567890'

	if(document.getElementById("taekbae1").checked == false && document.getElementById("taekbae2").checked == false){
		  		alert("배송방법을 선택하세요");
		  		return;
	}

  <?
  if($use_opt1 == 't'){
	 if(!empty($opts[0])){
		  echo "
		  	if(form.opt1.value == ''){
		  		alert(\"옵션을 선택하세요\");
		  		form.opt1.focus();
		  		return;
		  	}	
		  ";
	  }
	}
  ?>
  <?
  if($use_opt23 == 't'){
	 if(!empty($opts[1])){
		  echo "
		  	if(form.opt2.value == ''){
		  		alert(\"옵션을 선택하세요\");
		  		form.opt2.focus();
		  		return;
		  	}	
		  ";
	  }
	  if(!empty($opts[2])){
		  echo "
		  	if(form.opt3.value == ''){
		  		alert(\"옵션을 선택하세요\");
		  		form.opt3.focus();
		  		return;
		  	}	
		  ";
	  }
  }
  ?>





  
	if(form.quantity.value==''){
		alert("수량을 입력하세요.");
		form.quantity.focus();
		return;
	}
	else{
		var len =form.quantity.value.length;
		var ret;
		ret =false;		
		for(var i=0;i<len;i++){  
	   	var ch = form.quantity.value.substring(i,i+1);
	    
			for (var k=0;k<=Digit.length;k++){				
			
				if(Digit.substring(k,k+1) == ch)
				{					
					ret = true;
					break;					
				}
			}	
		 
			if (!ret){
				alert("숫자만 입력 하세요");
				form.quantity.focus();
				return;
			} 
			ret = false;
		}
	}
	<?
	if($jaego_use == '1'){
		echo "
	if(form.quantity.value > $jaego){
		alert(\"재고량을 초과하여 입력하셨습니다. $jaego 이하로 입력하세요.\");
		form.quantity.focus();
		return;
	}
		";
	}	
	?>
	form.action='../cart/cart_in.php?mart_id=<?=$mart_id?>&category_num=<?=$category_num?>&category_num1=<?=$category_num1?>&category_num2=<?=$category_num2?>&cate_num=<?=$cate_num?>&flag=<?=$flag?>&item_no=<?=$item_no?>';
	form.target = "_parent"
	form.submit();
}
function direct_submit(){
	var form			= document.form;
	var Digit = '1234567890'

	if(document.getElementById("taekbae1").checked == false && document.getElementById("taekbae2").checked == false){
		  		alert("배송방법을 선택하세요");
		  		return;
	}



  <?
  if($use_opt1 == 't'){
	 if(!empty($opts[0])){
		  echo "
		  	if(form.opt1.value == ''){
		  		alert(\"옵션을 선택하세요\");
		  		form.opt1.focus();
		  		return;
		  	}	
		  ";
	  }
	}
  ?>
  <?
  if($use_opt23 == 't'){
	 if(!empty($opts[1])){
		  echo "
		  	if(form.opt2.value == ''){
		  		alert(\"옵션을 선택하세요\");
		  		form.opt2.focus();
		  		return;
		  	}	
		  ";
	  }
	  if(!empty($opts[2])){
		  echo "
		  	if(form.opt3.value == ''){
		  		alert(\"옵션을 선택하세요\");
		  		form.opt3.focus();
		  		return;
		  	}	
		  ";
	  }
  }
  ?>
  
	if(form.quantity.value==''){
		alert("수량을 입력하세요.");
		form.quantity.focus();
		return;
	}
	else{
		var len =form.quantity.value.length;
		var ret;
		ret =false;		
		for(var i=0;i<len;i++){  
	   	var ch = form.quantity.value.substring(i,i+1);
	    
			for (var k=0;k<=Digit.length;k++){				
			
				if(Digit.substring(k,k+1) == ch)
				{					
					ret = true;
					break;					
				}
			}	
		 
			if (!ret){
				alert("숫자만 입력 하세요");
				form.quantity.focus();
				return;
			} 
			ret = false;
		}
	}
	<?
	if($jaego_use == '1'){
		echo "
	if(form.quantity.value > $jaego){
		alert(\"재고량을 초과하여 입력하셨습니다. $jaego 이하로 입력하세요.\");
		form.quantity.focus();
		return;
	}
		";
	}
	?>	
	form.action='../cart/cart_in.php?mart_id=<?=$mart_id?>&category_num=<?=$category_num?>&category_num1=<?=$category_num1?>&category_num2=<?=$category_num2?>&cate_num=<?=$cate_num?>&flag=<?=$flag?>&item_no=<?=$item_no?>';
	form.target = "_parent"
	form.direct_submit_flag.value='direct_submit';
	form.submit();
}
//-->
</script>

<script language="javascript">
<!--
var old_menu = '';
function toggleMenu(submenu) {
	if( old_menu != submenu ) {
		if( old_menu !='' ) {
			old_menu.style.display = 'none';
		}
		submenu.style.display = '';
		old_menu = submenu;
	} else {
		submenu.style.display = 'none';
		old_menu = '';
	}
}
//-->
</script>
<script language="javascript">
<!--	
function login_confirm(){
	if(confirm("로그인을 하셔야 이용할 수 있습니다.")){
		location.href="../member/login.html?url=<?=$url?>";
	}
}
//-->
</script>

<body>
<table width="100%"  border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td>
<!---------------------- 탑메뉴 시작 ---------------------------------------------------->

<?
include "../include/top.htm";
?>

<!---------------------- 탑메뉴 끝 ------------------------------------------------------>	
	</td>
  </tr>
</table>
<table width="100%"  border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td><table width="1000" align="center" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="238" valign="top">
<!----------------------------------서브메뉴 시작------------------------------------------>

<? include "../include/sub_menu.htm" ?>

<!----------------------------------서브메뉴 끝------------------------------------------>
		</td>
        <td width="763" align="center" valign="top">
				<?	include "../include/sub_top.htm"; ?>
<?
//================== 기획상품일때 ========================================================
if( $category_num <= "28" )
{
?>		
				<table width="749"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td height="46" background="../images/depth2_list_1.gif"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td width="2%">&nbsp;</td>
                  <td width="48%"><img src="../images/list_icon.gif" width="8" height="9" align="absmiddle">
									<span class="category_title"><?=$category_name?></span></td>
                  <td width="48%" align="right"><div align="right"><img src="../images/home_icon.gif" width="8" height="9" align="absmiddle"> <span class="navi"><a href="../main/index.html">홈</a> &gt; <!-- <a href="product_list.html?category_num=<?=$category_num?>">
                      <?=$category_name?>
                      </a>  &gt; --> <a href="product_list.html?category_num=<?=$category_num1?>"></a> <a href="product_list2.html?category_num=<?=$category_num1?>&category_num1=<?=$category_num2?>"> <?=$category_name?></a></span></div></td>
                  <td width="2%">&nbsp;</td>
                </tr>
            </table></td>
          </tr>
          <tr>
            <td background="../images/depth2_list_2.gif"><table width="93%"  border="0" align="center" cellpadding="0" cellspacing="0">
                <tr>
                  <td></td>
                </tr>
            </table></td>
          </tr>
          <tr>
            <td><img src="../images/depth2_list_3.gif" width="750" height="28">
<?
if($category_num == "143"){
?>
<a href="#" onclick="reserv_popup();"><img src="../images/manufacture_menu.gif" border="0"></a>
<?
}
?>
						</td>
          </tr>
        </table>
<?
}
else
{
?>		
		<table width="749"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td height="46" background="../images/depth2_list_1.gif"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
			   	<tr> <!-- 3차 상품등록 -->
                  <td width="2%">&nbsp;</td>
                  <td width="48%"><img src="../images/list_icon.gif" width="8" height="9" align="absmiddle"> <span class="category_title">
                    <?=$category_name2?>
                  </span> </td>
                  <td width="48%" align="right"><div align="right"><img src="../images/home_icon.gif" width="8" height="9" align="absmiddle"> <span class="navi"><a href="../main/index.html">홈</a> &gt; 
					<a href="product_list.html?category_num=<?=$category_num?>"><?=$category_name?></a> 
					<? if($category_num1){?>
						&gt; <a href="product_list2.html?category_num=<?=$category_num?>&category_num1=<?=$category_num1?>"><?=$category_name1?></a>
					<? } ?>
					<? if($category_num2!=$category_num && $category_num2!=$category_num1){?>
						 &gt; <a href="product_list3.html?category_num=<?=$category_num?>&category_num1=<?=$category_num1?>&category_num2=<?=$category_num2?>"><?=$category_name2?></a>
					<? } ?></span></div></td>
                  <td width="2%">&nbsp;</td>
                </tr>

            </table></td>
          </tr>
          <tr>
            <td background="../images/depth2_list_2.gif"><table width="93%"  border="0" align="center" cellpadding="0" cellspacing="0">
                <tr>
                  <td><span class="category_3">
                    <?
//================== 자신의 카테고리 정보를 불러옴 ==========================================
$sql_upcate = "select * from $CategoryTable where category_num='$cate_num' and if_hide='0' and mart_id='$mart_id' order by cat_order desc";
$rs_upcate = mysql_query($sql_upcate, $dbconn);
$total_upcate = mysql_num_rows( $rs_upcate );
$row = mysql_fetch_array($rs_upcate);
$up_category_num = $row[prevno];		// 상위레벨

if($category_num == $cate_num)
	$count_column = "firstno";
elseif($category_num1 == $cate_num)
	$count_column = "prevno";
else
	$count_column = "category_num";

$sql_cate1 = "select * from $CategoryTable where prevno='$up_category_num' and if_hide='0' and mart_id='$mart_id' order by cat_order desc";
$res_cate1 = mysql_query($sql_cate1, $dbconn);
$total_cate1 = mysql_num_rows( $res_cate1 );
$j = "0";
while( $row_cate2 = mysql_fetch_array( $res_cate1 ) ){
	$j++;
	$row_cate2[category_num];
	$row_cate2[category_name];

	$total_products = mysql_fetch_array(mysql_query("Select count(*) as count from $ItemTable where $count_column = '$row_cate2[category_num]'", $dbconn));

	if( $j < $total_cate1 ){
		$cut = "ㅣ";
	}else{
		$cut = "";
	}
	if($count_column == "firstno")
	{
		$cate_str = "<a 	href='../main/product_list.html?category_num=$row_cate2[category_num]'>$row_cate2[category_name]($total_products[count])</a> $cut";		// 1차 상품등록
	}elseif($count_column == "prevno"){
		$cate_str = "<a href='../main/product_list2.html?category_num=$category_num&category_num1=$row_cate2[category_num]'>$row_cate2[category_name]($total_products[count])</a> $cut";		// 2차 상품등록
	}else{
		$cate_str = "<a href='../main/product_list3.html?category_num=$category_num&category_num1=$category_num1&category_num2=$row_cate2[category_num]'>$row_cate2[category_name]($total_products[count])</a> $cut";		// 3차 상품등록
	}
?>
                    <?=$cate_str?>
<?
}
?>
                  </span></td>
                </tr>
            </table></td>
          </tr>
          <tr>
            <td><img src="../images/depth2_list_3.gif" width="750" height="28">
<?
if($category_num == "143"){
?>
<a href="#" onclick="reserv_popup();"><img src="../images/manufacture_menu.gif" border="0"></a>
<?
}
?>
						</td>
          </tr>
        </table>
<?
}
?>
		<table width="750"  border="0" cellspacing="0" cellpadding="0">
				<form action='<?=$PHP_SELF?>' name='form' method='post'>
				<input type='hidden' name='flag' value='addorder' >
				<input type='hidden' name='item_no' value='<?=$item_no?>'>
				<input type='hidden' name='item_name' value='<?=$item_name?>'>
				<input type='hidden' name='item_code' value='<?=$item_code?>'>
				<input type='hidden' name='mart_id' value='<?=$mart_id?>'>
				<input type='hidden' name='z_price' value='<?=$z_price?>'>
				<input type='hidden' name='bonus' value='<?=$bonus?>'>
				<input type='hidden' name='use_bonus' value='<?=$use_bonus?>'>
				<input type='hidden' name='direct_submit_flag' value=''>
				<input type='hidden' name='parcel_price' id="parcel_price" value='<?=$parcel_price?>'>
            	<tr>
            		<td width="10"></td>
            		<td width="740">
						<!--상품명-->
						<table width="740" border="0" cellspacing="0" cellpadding="0">
							<tr>
								<td height="10" colspan="2"></td>
							</tr>
							<tr>
								<td background="../image/product/title_bg.gif" class="product2"><img src="../image/product/title_icon.gif" width="30" height="30" align="absmiddle"><?=$item_name?>
								</td>
								<td background="../image/product/title_bg.gif" align='right'><!-- <a href="javascript:CenterWin('blank/counsel.htm','','resizable=yes,width=600,height=540')"><img src="../image/bu_counsel.gif" width="50" height="30" border="0"></a> --><img src="../image/product/title_end.gif" width="10" height="30"></td>
							</tr>
						</table>
						<!--상품명 END-->
						<!--상품사진 및 기본정보-->
						<table width="740" border="0" cellspacing="0" cellpadding="0">
							<tr>
								<td height="10" colspan="2"></td>
							</tr>
							<tr>
								<td width="<?=($view_product_img_width+10)?>" align="center" valign="top" colspan="2">
									<?=$img_link_str?><?=$img_str?></a><br>
								    <?=$img_link_str?><img src="../image/bu_zoom.gif" width="70" height="20" hspace="5" border="0"></a>
									<? 
									// 등록된 디렉토리가 1차,2차,3차 따라 링크 변경
									$product_list_url = "product_list3.html";
									if($category_num2==$category_num) $product_list_url = "product_list.html";
									if($category_num2==$category_num1) $product_list_url = "product_list2.html";
									?>									
									<a href="../main/<?=$product_list_url?>?mart_id=<?=$mart_id?>&category_num=<?=$category_num?>&category_num1=<?=$category_num1?>&category_num2=<?=$category_num2?>&flag=<?=$flag?>&page=<?=$page?>"><img src="../image/bu_list.gif" width="60" height="20" border="0" style="cursor:hand;"></a>
								</td>
								<td>
									<table width="390" border="0" cellspacing="0" cellpadding="0">
										<tr>
											<td><img src="../image/product/info_table_top.gif" width="390" height="20"></td>
										</tr>
										<tr>
											<td background="../image/product/info_table_bg.gif">
												<table width="350" border="0" align="center" cellpadding="4" cellspacing="2" bgcolor="#FFFFFF">
<?
if($if_customer_price=='1'&&$price>0){
?>
													<tr>
														<td width="80" bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle">소비자가</td>
														<td class="normal_price">
																<strike><?=$price_str?>원</strike>
														</td>
													</tr>
<?
}
?>
													<tr>
														<td width="80" bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle">판매가격</td>
														<td class="price">
															<b><?=$z_price_str?> 원</b>&nbsp;<?=$icon_str?></font>	
															<?if($gibon > 0){?>
															(수량:<?=$gibon?>개)
															<?}?>											

														</td>
													</tr>
<?
if($bonus_ok == 't'){
?>
													<tr>
														<td bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle">포인트</td>
														<td>2%적용</td>
													</tr>
<?
}
?>
													
													<tr>
														<td height="1" colspan="2" bgcolor="E5E5E5"></td>
													</tr>
													<tr>
														<td bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle">제조사</td>
														<td><?=$item_company?>&nbsp;</td>
													</tr>
<?
if( $item_code ){
?>
													<tr>
														<td bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle">상품코드</td>
														<td><?=$item_code?></td>
													</tr>
<?
}
?>
													<!-- <tr>
														<td bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle">무이자</td>
														<td>삼성,신한,비씨 3개월</td>
													</tr> -->
													<tr>
														<td bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle">상품평</td>
														<td><span class="text_orange"><?=$est_tot?></span>개의 상품평이 있습니다.<br><a href="#value"><img src="../image/bu_estimate_view.gif" width="70" height="20" hspace="3" border="0" align="absmiddle"></a><?=$write_memo?></td>
													</tr>
													<tr>
														<td height="1" colspan="2" bgcolor="E5E5E5"></td>
													</tr>
													<tr>
														<td bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle">구매수량</td>
														<td><input type="text" name='quantity' value='1' size='5' class="input_03"> 개</td>
													</tr>
													
<?
$opt1=stripcslashes($opt1);
$opt2=stripcslashes($opt2);
$opt3=stripcslashes($opt3);
$opts = explode("=", $opt);

if($use_opt1 == 't'){
	if(!empty($opts[0])){
		$opt1_str = "<select name='opt1' class='input_03' onChange='page_reload();'>";

		$op1 = explode("!", $opts[0]);
		$op1_count = count($op1);
		for($i=0;$i< $op1_count;$i++){
			$op1_1 = explode("^", $op1[$i]);
			if($i == 0)
				$opt1_str .= "<option value=''>옵션을 선택하세요</option>
				<option value=''>-----------------</option>";
			else{
				$opt1_str .= "<option value='$op1[$i]'";
				if($opt1 == $op1[$i]) $opt1_str .= "selected";
				$opt1_str .= ">$op1_1[0]</option>";
			}
		}
		$opt1_str .= "</select>";
?>
													<tr>
														<td bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle"><?=$op1[0]?></td>
														<td><?=$opt1_str?></td>
													</tr>
<?
	}
}
?>
<?
if($use_opt23 == 't'){
	if(!empty($opts[1])){
		$opt2_str = "<select name='opt2' class='input_03' onChange='page_reload();'>";
		$op2 = explode("!", $opts[1]);
		$op2_count = count($op2);
		for($i=0;$i< $op2_count;$i++){
			$op2_1 = explode("^", $op2[$i]);
			if($i == 0)
				$opt2_str .= "<option value=''>옵션을 선택하세요</option>
				<option value=''>-----------------</option>";
			else{
				$opt2_str .= "
					<option value='$op2[$i]'
				";
				if($opt2 == $op2[$i]) $opt2_str .= "selected";

				if($op2_1[1] == 0 || $op2_1[1] == ""){
					$opt2_str .= "
						>$op2_1[0]</option>
					";
				}else{
					$opt2_str .= "
						>$op2_1[0] (+".number_format($op2_1[1])."원)</option>
					";
				}
			}	
		}
		$opt2_str .= "</select>";
?>
															</select>
													<tr>
														<td bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle"><?=$op2[0]?></td>
														<td><?=$opt2_str?></td>
													</tr>
<?
	}	
?>
<?
	if(!empty($opts[2])){
		$opt3_str = "<select name='opt3' class='input_03' onChange='page_reload();'>";
		$op3 = explode("!", $opts[2]);
		$op3_count = count($op3);
		for($i=0;$i< $op3_count;$i++){
			$op3_1 = explode("^", $op3[$i]);
			if($i == 0)
				$opt3_str .= "<option value=''>옵션을 선택하세요</option>
				<option value=''>-----------------</option>";
			else{



				$opt3_str .= "
					<option value='$op3[$i]'
				";
				if($opt3 == $op3[$i]) $opt3_str .= "selected";

				if($op3_1[1] == 0 || $op3_1[1] == ""){
					$opt3_str .= "
						>$op3_1[0]</option>
					";
				}else{
					$opt3_str .= "
						>$op3_1[0] (+".number_format($op3_1[1])."원)</option>
					";
				}


			}
		}

		$opt3_str .= "</select>";
?>
														</select>
													<tr>
														<td bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle"><?=$op3[0]?></td>
														<td><?=$opt3_str?></td>
													</tr>
<?
	}
}
?>
													<tr>
														<td bgcolor="F8F8F8" class="text_14_s2"><img src="../image/icon_4.gif" width="15" height="9" align="absmiddle">배송정보</td>
														<td>
														
														
														
														<?
														if($fee == "고객선택"){
														?>
															
															<input type="radio" name="taekbae" id="taekbae1" value="선불" <?if($taekbae=="선불"){echo"checked";}?> onclick="form.parcel_price.value=<?=$parcel_price?>">선불배송		
															<input type="radio" name="taekbae" id="taekbae2" value="착불" <?if($taekbae=="착불"){echo"checked";}?> onclick="form.parcel_price.value=0">착불배송


														<?
														}else{
														?>
														
														<?=$me_delivery_str?>
														
														<?
														}
														?>											
														
														</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr>
											<td><img src="../image/product/info_table_bottom.gif" width="390" height="20"></td>
										</tr>
										<tr>
											<td height="60" align="center">
<?
if( ($jaego_use == 1 && $jaego == 0) || ($z_price==0) || ($if_hide==1)){
?>
												<img src="../image/bu_buy.gif" width="120" height="50" border="0"><img src="../image/bu_cart.gif" width="140" height="50" border="0">
<?
}else{
?>
												<a href='javascript:direct_submit()'><img src="../image/bu_buy.gif" width="120" height="50" border="0"></a><a href='javascript:addorder(this.form)'><img src="../image/bu_cart.gif" width="140" height="50" border="0"></a>
<?
}
?>
												<img src="../image/bu_wishlist.gif" width="140" height="50" border="0" style='cursor:hand' onClick="javascript:wishlist('<?=$item_no?>')">
											</td>
										</tr>
									</table>
								</td>
							</tr>
						</table>
<!----------------------------- 상품을 찜함 --------------------------------------------->
						<iframe name="add" frameborder="0" scrolling="no" height="0" width="0"></iframe>
<!--------------------------------------------------------------------------------------->
						<table width="740" border="0" cellspacing="0" cellpadding="0">
							<tr>
								<td valign="top">
<!---------------------- 상품 상세정보 시작 --------------------------------------------->
									<table width="100%" border="0" cellspacing="0" cellpadding="0">
										<tr>
											<td background="../image/product/info_title_1_bg.gif"><img src="../image/product/info_title_1.gif" width="130" height="50"></td>
										</tr>
										<tr>
											<td align='cener'>
												<table width='700' border="0" cellspacing="0" cellpadding="10">
													<tr>
														<td width='700'><p align='justify'><?=$item_explain?></p></td>
													</tr>
												</table>
											</td>
										</tr>
										<tr>
											<td height="20"><a name="value" id="value"></a></td>
										</tr>
									</table>
<!---------------------- 상품 상세정보 끝 ----------------------------------------------->
<?
if($user_words == 't'){
?>
<!---------------------- 상품평 리스트 시작 --------------------------------------------->
									<table width="100%" border="0" cellspacing="0" cellpadding="0">
										<tr>
											<td background="../image/product/info_title_2_bg.gif"><img src="../image/product/info_title_2.gif" width="130" height="50"></td>
										</tr>
										<tr>
											<td>
												<table width="100%"  border="0" cellspacing="0" cellpadding="10">
													<tr>
														<td>

<script language="javascript">
<!-- 
function est_del_win(est_no,mart_id){
	var url = './est_del.html?mart_id='+mart_id+'&est_no='+est_no 
	if(confirm("삭제하시겠습니까?")){
		window.open(url, '0x0', 'top=3000,left=3000,width=0,height=0');
	}
}
//-->
</script>
															<table width="100%"  border="0" cellspacing="0" cellpadding="0">
<?
if($est_tot == 0){
?>
																<tr height='30'>
																	<td colspan="3" align='center'>등록된 상품평이 없습니다.</td>
																</tr>
<?
}
?>
<?
$i = 0;
while($est_row = mysql_fetch_array($est_res)){
	$id = $est_tot - ($olds + $i);
	$i++;
	$est_no = $est_row[est_no];
	$title = $est_row[title];
	$name = $est_row[name];
	$write_date = $est_row[write_date];
	$content = nl2br($est_row[content]);
	$username = $est_row[username];
	$point = $est_row[point];
	$password = $est_row[password];
	
	if($title == ''){
		$title = substr($content, 0, 50);
		preg_match('/^([\x00-\x7e]|.{2})*/', $title, $title_tmp);
		if(strlen($content) > 50)
			$title_tmp[0] .= '..';
		$title = $title_tmp[0];
	}	
	
	$point_str = '';
	for($l=0;$l<$point;$l++){
		$point_str .= "<img src='../image/product/star_1.gif' align='asbmiddle'>";
	}
	$j = $est_tot - $i;
	$write_date_str = substr($write_date,0,4)."/".substr($write_date,4,2)."/".substr($write_date,6,2);

	if( $username == $UnameSess ){
		$modify_img = "<a onclick=\"CenterWin('./est_edit.html?mart_id=$mart_id&item_no=$item_no&est_no=$est_no','est_write', 'toolbar=no,menubar=no,status=no,scrollbars=yes,resizable=no,width=550,height=650');\" style='cursor:hand'><img src='../image/product/modify.gif'></a>";
		$del_img = "<a onclick=\"est_del_win('$est_no','$mart_id');\" style='cursor:hand'><img src='../image/product/delete.gif'></a>";
	}else{
		$modify_img = "<img src='../image/product/modify.gif'>";
		$del_img = "<img src='../image/product/delete.gif'>";
	}

	//========================= 회원 아이콘이 있으면 아이콘을 작성자에 표시 ==============
	if( $username ){
		//========================= 관리자 아이콘이 있으면 아이콘을 작성자에 표시 ========
		//$sql0 = "select admin_img from $MemberTable where username='$username'";
		//$res0 = mysql_query( $sql0 , $dbconn );
		//$tot0 = mysql_num_rows( $res0 );
		
		//if( $tot0 >0 ){
		//	$row0 = mysql_fetch_array( $res0 );
		//	$name = "<img src='../../up/$mart_id/$row0[admin_img]' border='0' align='absmiddle' height='20' width='25' height='25'>";
		//}else{
			//========================= 회원 아이콘이 있으면 아이콘을 작성자에 표시 ======
			$sql1 = "select member_img from $Mart_Member_NewTable where username='$username'";
			$res1 = mysql_query( $sql1 , $dbconn );
			$row1 = mysql_fetch_array( $res1 );
			if( $row1[member_img] ){
				$name = "<img src='../../up/$mart_id/$row1[member_img]' border='0' align='absmiddle' width='25' height='25'>";
			}else{
				$name = $name;
			} 
		//}
	}else{
		$name = $name;
	}
?>
																<tr>
																	<td height="30"><span class="text_name"><?=$name?></span> <a href="javascript:toggleMenu(estimate<?=$i?>)"><?=$title?></a> <?=$modify_img?> <?=$del_img?></td>
																	<td width="70" align="center"><?=$point_str?></td>
																	<td width="70" align="right" class="search_type"><?=$write_date_str ?></td>
																</tr>
																<tr id="estimate<?=$i?>" style="display:none">
																	<td colspan='2'>
																		<div > 
																		<table width='100%'>
																			<tr>
																				<td><?=$content?></td>
																			</tr>
																		</table>
																		</div>
																	</td>
																</tr>
																
																<tr>
																	<td height="1" colspan="3" bgcolor="E2E2E2"></td>
																</tr>
<?
}
?>
															</table>
															<table width="100%"  border="0" cellspacing="0" cellpadding="0">
																<tr>
<!---------------------- 페이징 시작 ---------------------------------------------------->
																	<td height="40" align='center'>
<? 
if($prev_list <= 0){ 
?>
																	<img src="../image/bu_pre10.gif" border='0' align="absmiddle">
<? 
}else{ 
?>

																	<a href="<?=$PHP_SELF?>?category_num=<?=$category_num?>&category_num1=<?=$category_num1?>&category_num2=<?=$category_num2?>&cate_num=<?=$cate_num?>&flag=<?=$flag?>&item_no=<?=$item_no?>&select_key=<?=$select_key?>&input_key=<?=$input_key?>&page=<?=$prev_list?>"><img src="../image/bu_pre10.gif" border='0' align="absmiddle"></a>

<? 
} 
?>
<? 
if($page-1 <= 0){ 
?>
																	<img src="../image/bu_pre.gif" border='0' align="absmiddle">
<? 
}else{ 
?>
																	<a href="<?=$PHP_SELF?>?category_num=<?=$category_num?>&category_num1=<?=$category_num1?>&category_num2=<?=$category_num2?>&cate_num=<?=$cate_num?>&flag=<?=$flag?>&item_no=<?=$item_no?>&select_key=<?=$select_key?>&input_key=<?=$input_key?>&page=<?=$page-1?>"><img src="../image/bu_pre.gif" border='0' align="absmiddle"></a>
<? 
} 
?>
																	&nbsp;
<? 
for($i=$start_page;$i<$start_page+$list;$i++){
?>
<? 
	if($i == $page){ 
?>
																	<b>[<?=$i?>]</b>
<? 
	}else{ 
?>

																	<a href="<?=$PHP_SELF?>?category_num=<?=$category_num?>&category_num1=<?=$category_num1?>&category_num2=<?=$category_num2?>&cate_num=<?=$cate_num?>&flag=<?=$flag?>&item_no=<?=$item_no?>&select_key=<?=$select_key?>&input_key=<?=$input_key?>&page=<?=$i?>">[<?=$i?>]</a>
<? 
	} 
?>
																	&nbsp;
<?
	if($i>=$total_page)
	break
?>
<? 
} 
?>
<? 
if($page+1 > $total_page){ 
?>
																	<img src="../image/bu_next.gif" border='0' align="absmiddle">
<? 
}else{ 
?>
																	<a href="<?=$PHP_SELF?>?category_num=<?=$category_num?>&category_num1=<?=$category_num1?>&category_num2=<?=$category_num2?>&cate_num=<?=$cate_num?>&flag=<?=$flag?>&item_no=<?=$item_no?>&select_key=<?=$select_key?>&input_key=<?=$input_key?>&page=<?=$page+1?>"><img src="../image/bu_next.gif" border='0' align="absmiddle"></a>
<? 
} 
?>
<? 
if($next_list>$total_page){ 
?>
																	<img src="../image/bu_next10.gif" border='0' align="absmiddle">
<? 
}else{ 
?>
																	<a href="<?=$PHP_SELF?>?category_num=<?=$category_num?>&category_num1=<?=$category_num1?>&category_num2=<?=$category_num2?>&cate_num=<?=$cate_num?>&flag=<?=$flag?>&item_no=<?=$item_no?>&select_key=<?=$select_key?>&input_key=<?=$input_key?>&page=<?=$next_list?>"><img src="../image/bu_next10.gif" border='0' align="absmiddle"></a>
<? 
} 
?>
																	</td>
<!---------------------- 페이징 끝 ------------------------------------------------------>
																	<td align="right"><?=$write_memo?></td>
																</tr>
															</table>
														</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr>
											<td height="20"></td>
										</tr>
									</table>
<!---------------------- 상품평 리스트 끝 ----------------------------------------------->
<?
}
?>
<!---------------------- 상품 Q&A 시작 -------------------------------------------------->
									<table width="100%"  border="0" cellspacing="0" cellpadding="0">
										<tr>
											<td background="../image/product/info_title_2_bg.gif"><img src="../image/product/info_title_7.gif" width="130" height="50"></td>
										</tr>
										<tr>
											<td>
												<table width="100%"  border="0" cellspacing="0" cellpadding="10">
													<tr>
														<td>
															<table width="100%"  border="0" cellspacing="0" cellpadding="0">
																<tr>
																	<td width="30" height="30" align="center"><img src="../image/product/qna_1.gif" width="20" height="30"></td>
																	<td height="30" align="center"><img src="../image/product/qna_2.gif" width="25" height="30"></td>
																	<td width="100" align="center"><img src="../image/product/qna_3.gif" width="30" height="30"></td>
																	<td width="100" align="center" class="search_type"><img src="../image/product/qna_4.gif" width="30" height="30"></td>
																</tr>
																<tr>
																	<td height="1" colspan="4" bgcolor="E2E2E2"></td>
																</tr>

<SCRIPT LANGUAGE="JavaScript">
<!--
function span_sw( str ) {
	if (str.style.display == "none") 
	str.style.display = ""; // Show
	else
	str.style.display = "none"; // Hidden
}
//-->
</SCRIPT>

<?
$bbs_no = "6";
$SQL1 = "select count(*) from $New_BoardTable where bbs_no='$bbs_no' and area='$item_no' and mart_id='$mart_id' "; 
$SQL2 = "and binary $keyset like '%$searchword%' ";
$SQL2_1 = "and (binary writer like '%$searchword%' or binary subject_new like '%$searchword%' or binary content like '%$searchword%') ";
$SQL3 = "";

if(isset($keyset)&&($keyset!="")&&isset($searchword)&&($searchword!="")&&($keyset != "all"))
	$SQL=$SQL1.$SQL2.$SQL3;
elseif(isset($keyset)&&($keyset!="")&&isset($searchword)&&($searchword!="")&&($keyset == "all"))
	$SQL=$SQL1.$SQL2_1.$SQL3;
else
	$SQL=$SQL1.$SQL3;

$dbresult = mysql_query($SQL, $dbconn);
$numRows_tot = mysql_result($dbresult,0,0);

$SQL1 = "select * from $New_BoardTable where bbs_no='$bbs_no' and area='$item_no' and mart_id='$mart_id' "; 
$SQL2 = "and binary $keyset like '%$searchword%' ";
$SQL2_1 = "and (binary writer like '%$searchword%' or binary subject_new like '%$searchword%' or binary content like '%$searchword%') ";
$SQL3 = "order by ansno asc";

if(isset($keyset)&&($keyset!="")&&isset($searchword)&&($searchword!="")&&($keyset != "all")){
	$SQL=$SQL1.$SQL2.$SQL3;
}elseif(isset($keyset)&&($keyset!="")&&isset($searchword)&&($searchword!="")&&($keyset == "all")){
	$SQL=$SQL1.$SQL2_1.$SQL3;
}else{
	$SQL=$SQL1.$SQL3;
}

$dbresult = mysql_query($SQL, $dbconn);
$numRows = mysql_num_rows($dbresult);

for ($i=0; $i < $numRows; $i++){
	$row = mysql_fetch_array( $dbresult );

	$index_no = $row[index_no];
	$writer = $row[writer];
	$user_id = $row[username];
	$write_date = $row[write_date];
	$read_num = $row[read_num];
	$subject_new = $row[subject_new];
	$step = $row[step];
	$if_secret = $row[if_secret];
	$content = $row[content];
	$step = $row[step];

	$write_date_tmp = substr($write_date,0,8);
	$today_tmp = date("Ymd");

	if(strlen($subject_new) > 50){
		$subject_new = substr($subject_new, 0, 50);
		preg_match('/^([\x00-\x7e]|.{2})*/', $subject_new, $subject_new_tmp);
		$subject_new_tmp[0] .= '..';
		$subject_new = $subject_new_tmp[0];
	}

	//========================= 회원 아이콘이 있으면 아이콘을 작성자에 표시 ==============
	if( $user_id ){
		//========================= 관리자 아이콘이 있으면 아이콘을 작성자에 표시 ========
		$sql0 = "select admin_img from $MemberTable where username='$user_id'";
		$res0 = mysql_query( $sql0 , $dbconn );
		$row0 = mysql_fetch_array( $res0 );
		if( $row0[admin_img] ){
			$member_img = "<img src='../../up/$mart_id/$row0[admin_img]' border='0' align='absmiddle' height='20'>";
		}else{
			$member_img = $writer;
		}
		
		if( !$row0[admin_img] ){
			//========================= 회원 아이콘이 있으면 아이콘을 작성자에 표시 ======
			$sql1 = "select member_img from $Mart_Member_NewTable where username='$user_id'";
			$res1 = mysql_query( $sql1 , $dbconn );
			$row1 = mysql_fetch_array( $res1 );
			if( $row1[member_img] ){
				$member_img = "<img src='../../up/$mart_id/$row1[member_img]' border='0' align='absmiddle' height='20'>";
			}else{
				$member_img = $writer;
			} 
		}
	}else{
		$member_img = $writer;
	}

	if($mart_id == 'pdazzle' && $bbs_no == '1'){
		$new_string = "";
	}else{
		if($write_date_tmp == $today_tmp){
			$new_string = "<img src='../../admin/images/new.gif'>";
		}else{
			$new_string = "";
		}
	}

	$k = $numRows_tot - $i;
	$write_date_str = substr($write_date,0,4)."/".substr($write_date,4,2)."/".substr($write_date,6,2);
	
	$j_str = "";
	for ($j=0; $j < $step; $j++) {
		$j_str = $j_str."&nbsp;";
	}
	if($step > 0){
		$j_str = $j_str."<img src='../images/re.gif'  align='absmiddle'>";
	}
	if($if_use_secret == '1' && $if_secret == '1'){
		$secret_str = "<img src='../images/key.gif'>";
	}else{
		$secret_str = '';
	}
	if($step > 0)
		$mark = "A";
	else
		$mark = "Q";
?>
																<tr height="30" bgcolor='#F9F7EA'>
																	<td width='30' align="center"><?=$mark?></td>
																	<td height="30"><A HREF="javascript:span_sw( show<?=$k?> );"><?=$subject_new?></a></td>
																	<td align="center"><?=$member_img?></td>
																	<td align="center" class="search_type"><?=$write_date_str?></td>
																</tr>
																<tr>
																	<td height="1" colspan="4" bgcolor="#E2E2E2"></td>
																</tr>
																<tr>
																	<td colspan='4'>
																		<span id='show<?=$k?>' style="display: none;">
																		<table width="100%"  border="0" cellspacing="0" cellpadding="0" bgcolor='#FFFFFF'>
																		<tr>
																			<td width='30' align="center"></td>
																			<td><?=nl2br($content)?></td>
																		</tr>
																		<tr>
																			<td height="1" colspan="2" bgcolor="#E2E2E2"></td>
																		</tr>
																		</table>
																		</span>
																	</td>
																</tr>
<?     				
}
?>
															</table>
															<table width="100%"  border="0" cellspacing="0" cellpadding="0">
																<tr>
																	<td height="40" align='right'><a onclick="CenterWin('../board/board_write.php?mart_id=<?=$mart_id?>&bbs_no=6&item_no=<?=$item_no?>&return=product','qna_write', 'toolbar=no,menubar=no,status=no,scrollbars=yes,resizable=no,width=700,height=500');" style='cursor:hand'><img src="../image/bu_counsel3.gif" width="60" height="20" border="0" align="absmiddle"></a></td>
																</tr>
															</table>
														</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr>
											<td height="20"><a name="value" id="value"></a></td>
										</tr>
									</table>
<!---------------------- 상품 Q&A 끝 ---------------------------------------------------->
								</td>
								<td height="2" bgcolor="3F9887"></td>
							</tr>
							<tr>
								<!-- <td width="1" bgcolor="E2E2E2"></td> -->
								<td width="100%" valign="top">
									<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
<!---------------------- 오늘 쇼핑한 상품 시작 ---------------------------------------->
										<tr>
											<td height="60"><img src="../image/product/info_title_3.gif" ></td>
										</tr>
										<tr>
											<td bgcolor="#FFFFFF">
<?
include "today.html";
?>
											</td>
										</tr>
									</table>
<!---------------------- 오늘 쇼핑한 상품 끝 -------------------------------------------->
<!---------------------- 배송/무이자/교환활부 안내 시작 --------------------------------->
<?
include "../design/delivery.html";
?>
<!---------------------- 배송/무이자/교환활부 안내 끝 ----------------------------------->
								</td>
								<td width="1" bgcolor="E2E2E2"></td>
							</tr>
						</table>
					</td>
           		</tr>
				</form>
           	</table>
		</td>
      </tr>
    </table></td>
  </tr>
</table>
<table width="100%"  border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td>
<!---------------------- 하단메뉴 시작 -------------------------------------------------->
<?
include "../include/bottom.htm";
?>
<!---------------------- 하단메뉴 끝 ---------------------------------------------------->	
	</td>
  </tr>
</table>
</body>
</html>
<?
mysql_close($dbconn);
?>